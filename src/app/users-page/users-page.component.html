<!-- After -->
@let users = [
	...pinnedUsers,
	...searchResults,
	...suggestedUsers,
	...invitedUsers
];

<!-- After -->
@let sharedButtonConfig = {
	label: 'Delete',
	icon: 'trash',
	confirm: true,
};

@let sharedAdminButtonConfig = {
	...sharedButtonConfig,
	tone: 'danger',
	disabled: isBusy(),
};

<div class="page-container">
	<div class="controls">
		<label>
			<input
				type="checkbox"
				[checked]="isAdmin()"
				(change)="onAdminChange($event)"
			/>
			Admin
		</label>
		<label>
			<input
				type="checkbox"
				[checked]="isBusy()"
				(change)="onBusyChange($event)"
			/>
			Is Busy
		</label>
		@if (isAdmin()) {
			<div>
				<label>Delete all users</label>

				<!-- Before -->
				<app-action-button
					[config]="{
						label: 'Delete',
						icon: 'trash',
						confirm: true,
						tone: 'danger',
						disabled: isBusy(),
						telemetry: { event: 'delete_all_clicked', source: 'controls' }
					}"
				/>

				<!-- After -->
				<app-action-button
					[config]="{
						...sharedAdminButtonConfig,
						telemetry: { event: 'delete_all_clicked', source: 'controls' }
					}"
				/>
			</div>
		}
	</div>
	<div class="users-section">
		<div class="users-header">
			<label>
				<!-- Before -->
				<!-- <input
					type="checkbox"
					[checked]="selection().size === users().length"
					[indeterminate]="selection().size > 0 && selection().size < users().length"
					(change)="toggleAllSelection()"
				/> -->

				<!-- After -->
				<input
					type="checkbox"
					[checked]="selection().size === users.length"
					[indeterminate]="selection().size > 0 && selection().size < users.length"
					(change)="toggleAllSelection()"
				/>
				Select All
			</label>
			<span class="selection-count">
				{{ selectedCount() }} selected
			</span>
		</div>

		<ul class="users-list">
			<!-- Before -->
			<!-- @for (user of users(); track user.id) { -->

			@for (user of users; track user.id) {
				<li>
					<label>
						<input
							type="checkbox"
							[checked]="selection().has(user.id)"
							(change)="toggleUserSelection(user.id)"
						/>
						<span class="user-info">
							<strong>{{ user.name }}</strong>
							<span class="email">{{ user.email }}</span>
						</span>
					</label>
					<div class="user-actions">
						<!-- Before -->
						@if (isAdmin()) {
							<app-action-button
								[config]="{
									label: 'Delete',
									icon: 'trash',
									confirm: true,
									tone: 'danger',
									disabled: isBusy(),
									telemetry: { event: 'admin_delete_clicked', source: 'row_menu' }
								}"
							/>
						} @else {
							<app-action-button
								[config]="{
									label: 'Delete',
									icon: 'trash',
									confirm: true,
									tone: 'warning',
									disabled: true,
									telemetry: {}
								}"
							/>
						}

						<!-- After -->
						@if (isAdmin()) {
							<app-action-button [config]="{
								...sharedAdminButtonConfig,
								telemetry: { event: 'admin_delete_clicked', source: 'row_menu' }
							}" />
						} @else {
							<app-action-button [config]="{
								...sharedButtonConfig,
								tone: 'warning',
								disabled: true,
								telemetry: {}
							}" />
						}
					</div>
				</li>
			}
		</ul>
	</div>
</div>
